<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Placement Portal</title>
  <style>
    :root{--accent:#2563eb;--muted:#6b7280;--bg:#f8fafc;--card:#ffffff}
    *{box-sizing:border-box}body{font-family:Inter,ui-sans-serif,system-ui,Arial;background:var(--bg);margin:0;color:#0f172a}
    .container{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px}
    h1{margin:0;font-size:20px}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:20px}

    /* Card */
    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(16,24,40,0.06)}

    /* Job list */
    .job{padding:12px;border-radius:8px;border:1px solid #eef2ff;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
    .job-title{font-weight:600}
    .job-meta{font-size:13px;color:var(--muted)}

    /* Forms */
    label{display:block;font-size:13px;margin-bottom:6px}
    input[type=text],input[type=email],select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ee;margin-bottom:10px;font-size:14px}
    textarea{min-height:80px}

    /* Student dashboard */
    .small{font-size:13px}
    .link{color:var(--accent);cursor:pointer;text-decoration:underline}

    /* Responsive */
    @media (max-width:920px){.grid{grid-template-columns:1fr;}.container{padding:12px}}

    footer{margin-top:20px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Placement Portal — Simple Demo</h1>
        <div class="muted">Manage jobs, register students, and apply — all in your browser (localStorage)</div>
      </div>
      <div>
        <button class="btn" onclick="openRegister()">Student Register</button>
        <button class="btn" style="background:#10b981;margin-left:8px" onclick="openPostJob()">Post Job</button>
      </div>
    </header>

    <main class="grid">
      <section>
        <div class="card">
          <h3 style="margin-top:0">Available Jobs</h3>
          <div id="jobsList" aria-live="polite"></div>
          <div id="no-jobs" class="muted small" style="display:none">No jobs posted yet. Click "Post Job" to add one.</div>
        </div>

        <div class="card" style="margin-top:16px">
          <h3 style="margin-top:0">Search & Filters</h3>
          <input id="searchInput" placeholder="Search by title or company" oninput="renderJobs()" />
          <div style="display:flex;gap:8px;margin-top:8px">
            <select id="filterType" onchange="renderJobs()">
              <option value="">All types</option>
              <option value="Internship">Internship</option>
              <option value="Full-time">Full-time</option>
            </select>
            <select id="filterBranch" onchange="renderJobs()">
              <option value="">All branches</option>
              <option value="CSE">CSE</option>
              <option value="ECE">ECE</option>
              <option value="MECH">MECH</option>
              <option value="EEE">EEE</option>
            </select>
          </div>
        </div>

      </section>

      <aside>
        <div class="card">
          <h3 style="margin-top:0">Quick Actions</h3>
          <p class="small">Have a student account?</p>
          <div style="display:flex;gap:8px">
            <button class="btn" onclick="openLogin()">Student Login</button>
            <button class="btn" style="background:#ef4444" onclick="clearAll()">Reset Demo</button>
          </div>
          <hr style="margin:12px 0" />
          <h4 style="margin:6px 0">Admin</h4>
          <p class="small muted">Simple admin panel to view applications</p>
          <button class="btn" style="background:#6b7280" onclick="openAdmin()">Open Admin View</button>
        </div>
      </aside>
    </main>

    <footer>This is a demo placement portal — data is stored locally in your browser.</footer>
  </div>

  <!-- Modals (simple) -->
  <div id="modal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.4);padding:20px">
    <div id="modalCard" style="width:100%;max-width:640px;background:#fff;border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.2)">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 id="modalTitle">Modal</h3>
        <button onclick="closeModal()" style="background:transparent;border:0;font-size:18px;cursor:pointer">✖</button>
      </div>
      <div id="modalBody" style="margin-top:8px"></div>
    </div>
  </div>

  <script>
    /* ---------- Storage helpers ---------- */
    const LS_KEYS = { JOBS: 'pp_demo_jobs_v1', STUDENTS: 'pp_demo_students_v1', APPS: 'pp_demo_apps_v1' };

    function load(key){try{const s=localStorage.getItem(key);return s?JSON.parse(s):[]}catch(e){return[]}}
    function save(key,data){localStorage.setItem(key,JSON.stringify(data))}

    /* ---------- Initial render ---------- */
    function ensureDemo(){if(load(LS_KEYS.JOBS).length===0){const sample=[
      {id:gid(),title:'Frontend Intern',company:'BlueTech',type:'Internship',branch:'CSE',stipend:'10k/month',desc:'Work on React UI components'},
      {id:gid(),title:'Embedded Systems Engineer',company:'MakerWorks',type:'Full-time',branch:'ECE',stipend:'25k/month',desc:'Firmware and HW testing'}
    ];save(LS_KEYS.JOBS,sample)}if(load(LS_KEYS.STUDENTS).length===0){save(LS_KEYS.STUDENTS,[])}if(load(LS_KEYS.APPS).length===0){save(LS_KEYS.APPS,[])}renderJobs()}

    function gid(){return 'id_'+Math.random().toString(36).slice(2,9)}

    /* ---------- Jobs UI ---------- */
    function renderJobs(){const jobs=load(LS_KEYS.JOBS);const container=document.getElementById('jobsList');container.innerHTML='';
      const q=document.getElementById('searchInput').value.trim().toLowerCase();
      const typ=document.getElementById('filterType').value;const br=document.getElementById('filterBranch').value;
      const filtered=jobs.filter(j=>{
        if(typ && j.type!==typ) return false; if(br && j.branch!==br) return false;
        if(!q) return true; return (j.title+j.company+j.desc).toLowerCase().includes(q);
      });
      if(filtered.length===0){document.getElementById('no-jobs').style.display='block';return} else {document.getElementById('no-jobs').style.display='none'}
      filtered.forEach(j=>{const el=document.createElement('div');el.className='job';el.innerHTML=`<div>
        <div class="job-title">${escapeHtml(j.title)}</div>
        <div class="job-meta">${escapeHtml(j.company)} • ${escapeHtml(j.type)} • ${escapeHtml(j.branch)}</div>
        <div class="small muted">${escapeHtml(j.desc)}</div>
      </div>
      <div style="text-align:right">
        <div class="small muted">${escapeHtml(j.stipend||'—')}</div>
        <button class="btn" style="margin-top:8px" onclick="applyClicked('${j.id}')">Apply</button>
      </div>`;container.appendChild(el)})}

    function escapeHtml(s){if(!s) return '';return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')}

    /* ---------- Apply flow ---------- */
    function applyClicked(jobId){const current=load(LS_KEYS.STUDENTS_CURRENT)||null; // not persisted key — we will use modal flow
      const students=load(LS_KEYS.STUDENTS);
      if(students.length===0){openRegister('apply',jobId);return}
      // ask to login (choose) if multiple
      openLogin(jobId);
    }

    /* ---------- Modal flows (Register, Post Job, Login, Admin) ---------- */
    function openModal(title,bodyHtml){document.getElementById('modalTitle').innerText=title;document.getElementById('modalBody').innerHTML=bodyHtml;document.getElementById('modal').style.display='flex'}
    function closeModal(){document.getElementById('modal').style.display='none'}

    function openRegister(after,nullJobId){const body=`<form id="regForm">
        <label>Full name<input name="name" required type="text"/></label>
        <label>Email<input name="email" required type="email"/></label>
        <label>USN / Roll no<input name="usn" required type="text"/></label>
        <label>Branch<select name="branch"><option>CSE</option><option>ECE</option><option>MECH</option><option>EEE</option></select></label>
        <label>Phone<input name="phone" type="text"/></label>
        <div style="display:flex;gap:8px;margin-top:8px"><button class="btn" type="submit">Register</button><button type="button" onclick="closeModal()" style="padding:8px;border-radius:8px">Cancel</button></div>
      </form>`;
      openModal('Student Registration',body);
      document.getElementById('regForm').onsubmit=function(e){e.preventDefault();const fd=new FormData(e.target);const obj=Object.fromEntries(fd.entries());obj.id=gid();
        const students=load(LS_KEYS.STUDENTS);students.push(obj);save(LS_KEYS.STUDENTS,students);alert('Registered ✅');closeModal();renderJobs();
        // if called by apply flow: auto login and apply
        if(after==='apply' && nullJobId){loginAndApply(obj.email,nullJobId)} }
    }

    function openPostJob(){const body=`<form id="jobForm">
        <label>Job title<input name="title" required type="text"/></label>
        <label>Company<input name="company" required type="text"/></label>
        <label>Type<select name="type"><option>Internship</option><option>Full-time</option></select></label>
        <label>Branch<select name="branch"><option>CSE</option><option>ECE</option><option>MECH</option><option>EEE</option></select></label>
        <label>Stipend / Salary<input name="stipend" type="text"/></label>
        <label>Description<textarea name="desc"></textarea></label>
        <div style="display:flex;gap:8px;margin-top:8px"><button class="btn" type="submit">Post Job</button><button type="button" onclick="closeModal()" style="padding:8px;border-radius:8px">Cancel</button></div>
      </form>`;
      openModal('Post a Job',body);
      document.getElementById('jobForm').onsubmit=function(e){e.preventDefault();const j=Object.fromEntries(new FormData(e.target).entries());j.id=gid();const jobs=load(LS_KEYS.JOBS);jobs.unshift(j);save(LS_KEYS.JOBS,jobs);alert('Job posted ✅');closeModal();renderJobs()}
    }

    function openLogin(preApplyJobId){const students=load(LS_KEYS.STUDENTS);
      if(students.length===0){openRegister('apply',preApplyJobId);return}
      let options = students.map(s=>`<option value="${s.email}">${s.name} — ${s.email}</option>`).join('');
      const body=`<div>
        <label>Select student account<select id="loginSelect">${options}</select></label>
        <div style="display:flex;gap:8px;margin-top:8px"><button class="btn" onclick="performLogin('${preApplyJobId||''}')">Continue</button><button type="button" onclick="closeModal()" style="padding:8px;border-radius:8px">Cancel</button></div>
      </div>`;
      openModal('Student Login',body);
    }

    function performLogin(preApplyJobId){const sel=document.getElementById('loginSelect');if(!sel) return;const email=sel.value;const students=load(LS_KEYS.STUDENTS);const user=students.find(s=>s.email===email);if(!user){alert('Student not found');return}closeModal();if(preApplyJobId){loginAndApply(email,preApplyJobId)}else{openStudentDashboard(user)}}

    function loginAndApply(email,jobId){const students=load(LS_KEYS.STUDENTS);const user=students.find(s=>s.email===email);if(!user){alert('Student not found');return}
      const apps=load(LS_KEYS.APPS);const already=apps.find(a=>a.jobId===jobId && a.studentEmail===email);if(already){alert('You already applied to this job');return}
      apps.push({id:gid(),jobId,studentEmail:email,appliedAt:new Date().toISOString()});save(LS_KEYS.APPS,apps);alert('Application submitted ✅');}

    function openStudentDashboard(user){const apps=load(LS_KEYS.APPS);const jobs=load(LS_KEYS.JOBS);const mine=apps.filter(a=>a.studentEmail===user.email);
      let list = mine.map(a=>{const job=jobs.find(j=>j.id===a.jobId);return `<div style="padding:8px;border-bottom:1px solid #f3f4f6"><div style="font-weight:600">${escapeHtml(job?.title||'—')}</div><div class="small muted">${escapeHtml(job?.company||'—')} • ${new Date(a.appliedAt).toLocaleString()}</div></div>`}).join('')||'<div class="muted small">No applications yet.</div>';
      const body=`<div><h4>Hello, ${escapeHtml(user.name)}</h4><p class="small muted">Registered: ${escapeHtml(user.usn||'—')}</p><hr/>${list}<div style="margin-top:8px"><button class="btn" onclick="closeModal()">Close</button></div></div>`;
      openModal('Student Dashboard',body);
    }

    /* ---------- Admin ---------- */
    function openAdmin(){const apps=load(LS_KEYS.APPS);const students=load(LS_KEYS.STUDENTS);const jobs=load(LS_KEYS.JOBS);
      const rows = apps.map(a=>{const j=jobs.find(x=>x.id===a.jobId)||{};const s=students.find(x=>x.email===a.studentEmail)||{};return `<div style="padding:10px;border-bottom:1px solid #f3f4f6"><div style="font-weight:600">${escapeHtml(j.title||'—')} at ${escapeHtml(j.company||'—')}</div><div class="small muted">Applicant: ${escapeHtml(s.name||a.studentEmail)} — ${escapeHtml(s.usn||'—')}</div><div class="small muted">Applied: ${new Date(a.appliedAt).toLocaleString()}</div></div>`}).join('')||'<div class="muted small">No applications yet.</div>';
      openModal('Admin — Applications',`<div>${rows}<div style="margin-top:8px"><button class="btn" onclick="closeModal()">Close</button></div></div>`);
    }

    /* ---------- Helpers ---------- */
    function clearAll(){if(!confirm('This will clear local demo data. Continue?')) return;localStorage.removeItem(LS_KEYS.JOBS);localStorage.removeItem(LS_KEYS.STUDENTS);localStorage.removeItem(LS_KEYS.APPS);ensureDemo();alert('Reset done')}

    // On first load
    ensureDemo();
  </script>
</body>
</html>
